<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genesis Interface - Human-AI Co-Creation</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .workflow-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .workflow-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .workflow-stages {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stage {
            flex: 1;
            min-width: 150px;
            padding: 20px;
            margin: 10px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .stage.doubt { background: #ffeaa7; border: 2px solid #d63031; }
        .stage.discovery { background: #a29bfe; border: 2px solid #6c5ce7; }
        .stage.art { background: #fd79a8; border: 2px solid #e84393; }
        .stage.wisdom { background: #00b894; border: 2px solid #00cec9; }
        .stage.knowledge { background: #fdcb6e; border: 2px solid #e17055; }
        .stage.publication { background: #6c5ce7; border: 2px solid #a29bfe; color: white; }

        .stage.active { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .stage.completed { opacity: 0.7; }

        .stage-arrow {
            display: none;
        }

        .workflow-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn-primary { background: #6c5ce7; color: white; }
        .btn-primary:hover { background: #5a4fcf; }

        .btn-secondary { background: #a29bfe; color: white; }
        .btn-secondary:hover { background: #8c7ae6; }

        .workflow-status {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .artwork-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .artwork-item {
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .artwork-item:hover {
            transform: scale(1.05);
        }

        .artwork-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .artwork-item .content {
            padding: 15px;
        }

        .feedback-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .feedback-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
        }

        .rating-stars {
            text-align: center;
            margin: 20px 0;
        }

        .star {
            font-size: 30px;
            color: #ddd;
            cursor: pointer;
            margin: 0 5px;
        }

        .star.selected {
            color: #ffd700;
        }

        .philosophy-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .philosophy-section h2 {
            margin-bottom: 20px;
        }

        .cycle-diagram {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .cycle-step {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            margin: 10px;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .workflow-stages {
                flex-direction: column;
            }

            .stage {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="workflow-container">
        <header class="workflow-header">
            <h1>üß¨ Genesis Interface</h1>
            <p>Human-AI Co-Creation Through Posthuman Creativity</p>
        </header>

        <!-- Philosophy Section -->
        <section class="philosophy-section">
            <h2>Posthuman Creativity Philosophy</h2>
            <p>Humans and AI as co-creators in a symbiotic relationship, extending human creative potential through technology.</p>
            <div class="cycle-diagram">
                <div class="cycle-step">ü§î<br>Doubt</div>
                <div class="cycle-step">üîç<br>Discovery</div>
                <div class="cycle-step">üé®<br>Art</div>
                <div class="cycle-step">üß†<br>Wisdom</div>
                <div class="cycle-step">üìö<br>Knowledge</div>
            </div>
        </section>

        <!-- Workflow Stages -->
        <div class="workflow-stages">
            <div class="stage doubt" id="stage-doubt">
                <h3>ü§î Doubt</h3>
                <p>Human curiosity and questions</p>
            </div>
            <div class="stage discovery" id="stage-discovery">
                <h3>üîç Discovery</h3>
                <p>Autonomous exploration</p>
            </div>
            <div class="stage art" id="stage-art">
                <h3>üé® Art</h3>
                <p>Creative generation</p>
            </div>
            <div class="stage wisdom" id="stage-wisdom">
                <h3>üß† Wisdom</h3>
                <p>Knowledge synthesis</p>
            </div>
            <div class="stage knowledge" id="stage-knowledge">
                <h3>üìö Knowledge</h3>
                <p>Legacy preservation</p>
            </div>
            <div class="stage publication" id="stage-publication">
                <h3>üì§ Publication</h3>
                <p>Sharing with the world</p>
            </div>
        </div>

        <!-- Workflow Form -->
        <div class="workflow-form">
            <h2>Start Co-Creation Workflow</h2>
            <form id="workflow-form">
                <div class="form-group">
                    <label for="trigger-source">Trigger Source:</label>
                    <select id="trigger-source" required>
                        <option value="human">Human Input</option>
                        <option value="autonomous">Autonomous</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="human-input">Your Creative Prompt or Question:</label>
                    <textarea id="human-input" placeholder="What creative exploration would you like to embark on? Describe your doubt, curiosity, or artistic vision..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="workflow-id">Workflow ID (optional):</label>
                    <input type="text" id="workflow-id" placeholder="Leave empty for auto-generation">
                </div>

                <button type="submit" class="btn btn-primary">üöÄ Start Co-Creation Journey</button>
                <button type="button" id="trigger-autonomous" class="btn btn-secondary">ü§ñ Trigger Autonomous Exploration</button>
            </form>
        </div>

        <!-- Workflow Status -->
        <div class="workflow-status" id="workflow-status" style="display: none;">
            <h2>Current Workflow Status</h2>
            <div id="status-content">
                <p>Loading workflow status...</p>
            </div>
            <button id="refresh-status" class="btn btn-secondary">üîÑ Refresh Status</button>
        </div>

        <!-- Artwork Gallery -->
        <div id="artwork-gallery" style="display: none;">
            <h2>üé® Generated Artworks</h2>
            <div class="artwork-gallery" id="artwork-grid">
                <!-- Artworks will be populated here -->
            </div>
        </div>

        <!-- Feedback Modal -->
        <div class="feedback-modal" id="feedback-modal">
            <div class="feedback-content">
                <span class="close-btn" id="close-feedback">&times;</span>
                <h2>Provide Human Feedback</h2>
                <p>Help shape the creative process with your insights!</p>

                <div class="rating-stars">
                    <span class="star" data-rating="1">‚≠ê</span>
                    <span class="star" data-rating="2">‚≠ê</span>
                    <span class="star" data-rating="3">‚≠ê</span>
                    <span class="star" data-rating="4">‚≠ê</span>
                    <span class="star" data-rating="5">‚≠ê</span>
                </div>

                <div class="form-group">
                    <label for="feedback-text">Your Feedback:</label>
                    <textarea id="feedback-text" placeholder="What did you think? How can we improve the creative process?"></textarea>
                </div>

                <div class="form-group">
                    <label for="curation-decisions">Curation Decisions:</label>
                    <textarea id="curation-decisions" placeholder="Any specific curation choices or directions for the AI?"></textarea>
                </div>

                <button id="submit-feedback" class="btn btn-primary">üì§ Submit Feedback</button>
            </div>
        </div>
    </div>

    <script>
        class GenesisInterface {
            constructor() {
                this.apiBaseUrl = 'http://localhost:8000/api';
                this.currentWorkflowId = null;
                this.selectedRating = null;
                this.init();
            }

            init() {
                this.bindEvents();
                this.loadPhilosophy();
            }

            bindEvents() {
                // Form submission
                document.getElementById('workflow-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.startWorkflow();
                });

                // Autonomous trigger
                document.getElementById('trigger-autonomous').addEventListener('click', () => {
                    this.triggerAutonomousWorkflow();
                });

                // Status refresh
                document.getElementById('refresh-status').addEventListener('click', () => {
                    this.refreshWorkflowStatus();
                });

                // Feedback modal
                document.getElementById('close-feedback').addEventListener('click', () => {
                    this.hideFeedbackModal();
                });

                // Star rating
                document.querySelectorAll('.star').forEach(star => {
                    star.addEventListener('click', (e) => {
                        this.selectRating(e.target.dataset.rating);
                    });
                });

                // Submit feedback
                document.getElementById('submit-feedback').addEventListener('click', () => {
                    this.submitFeedback();
                });

                // Close modal on outside click
                window.addEventListener('click', (e) => {
                    const modal = document.getElementById('feedback-modal');
                    if (e.target === modal) {
                        this.hideFeedbackModal();
                    }
                });
            }

            async loadPhilosophy() {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/workflow/philosophy`);
                    const philosophy = await response.json();

                    // Update philosophy section with dynamic content
                    console.log('Philosophy loaded:', philosophy);
                } catch (error) {
                    console.warn('Could not load philosophy:', error);
                }
            }

            async startWorkflow() {
                const triggerSource = document.getElementById('trigger-source').value;
                const humanInput = document.getElementById('human-input').value;
                const workflowId = document.getElementById('workflow-id').value;

                try {
                    const response = await fetch(`${this.apiBaseUrl}/workflow/start`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            trigger_source: triggerSource,
                            human_input: humanInput,
                            workflow_id: workflowId || undefined
                        })
                    });

                    const result = await response.json();

                    if (response.ok) {
                        this.currentWorkflowId = result.workflow_id;
                        this.showWorkflowStatus();
                        this.updateStageStatus('doubt', 'active');
                        alert(`Workflow started! ID: ${this.currentWorkflowId}`);
                    } else {
                        alert(`Error: ${result.detail}`);
                    }

                } catch (error) {
                    alert(`Network error: ${error.message}`);
                }
            }

            async triggerAutonomousWorkflow() {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/workflow/trigger-autonomous`, {
                        method: 'POST'
                    });

                    const result = await response.json();

                    if (response.ok) {
                        this.currentWorkflowId = result.workflow_id;
                        this.showWorkflowStatus();
                        alert(`Autonomous workflow triggered! ID: ${this.currentWorkflowId}`);
                    } else {
                        alert(`Error: ${result.detail}`);
                    }

                } catch (error) {
                    alert(`Network error: ${error.message}`);
                }
            }

            async refreshWorkflowStatus() {
                if (!this.currentWorkflowId) return;

                try {
                    const response = await fetch(`${this.apiBaseUrl}/workflow/status/${this.currentWorkflowId}`);
                    const status = await response.json();

                    if (response.ok) {
                        this.updateWorkflowStatusDisplay(status);
                        this.updateStageVisuals(status.stages_completed);
                    } else {
                        document.getElementById('status-content').innerHTML = `<p>Error: ${status.detail}</p>`;
                    }

                } catch (error) {
                    document.getElementById('status-content').innerHTML = `<p>Network error: ${error.message}</p>`;
                }
            }

            updateWorkflowStatusDisplay(status) {
                const statusHtml = `
                    <div class="status-item">
                        <span><strong>Workflow ID:</strong></span>
                        <span>${status.workflow_id}</span>
                    </div>
                    <div class="status-item">
                        <span><strong>Current Stage:</strong></span>
                        <span>${status.current_stage}</span>
                    </div>
                    <div class="status-item">
                        <span><strong>Stages Completed:</strong></span>
                        <span>${status.stages_completed.join(', ')}</span>
                    </div>
                    <div class="status-item">
                        <span><strong>Success:</strong></span>
                        <span>${status.success ? '‚úÖ Yes' : '‚è≥ In Progress'}</span>
                    </div>
                    ${status.completion_time ? `
                    <div class="status-item">
                        <span><strong>Completed:</strong></span>
                        <span>${new Date(status.completion_time).toLocaleString()}</span>
                    </div>
                    ` : ''}
                `;

                document.getElementById('status-content').innerHTML = statusHtml;
            }

            updateStageVisuals(completedStages) {
                // Reset all stages
                document.querySelectorAll('.stage').forEach(stage => {
                    stage.classList.remove('active', 'completed');
                });

                // Mark completed stages
                completedStages.forEach(stage => {
                    const stageElement = document.getElementById(`stage-${stage}`);
                    if (stageElement) {
                        stageElement.classList.add('completed');
                    }
                });

                // Mark current stage as active
                if (completedStages.length > 0) {
                    const currentStage = completedStages[completedStages.length - 1];
                    const stageElement = document.getElementById(`stage-${currentStage}`);
                    if (stageElement) {
                        stageElement.classList.add('active');
                    }
                }
            }

            updateStageStatus(stage, status) {
                const stageElement = document.getElementById(`stage-${stage}`);
                if (stageElement) {
                    stageElement.classList.add(status);
                }
            }

            showWorkflowStatus() {
                document.getElementById('workflow-status').style.display = 'block';
                this.refreshWorkflowStatus();
            }

            showFeedbackModal() {
                document.getElementById('feedback-modal').style.display = 'flex';
            }

            hideFeedbackModal() {
                document.getElementById('feedback-modal').style.display = 'none';
            }

            selectRating(rating) {
                // Reset all stars
                document.querySelectorAll('.star').forEach(star => {
                    star.classList.remove('selected');
                });

                // Select stars up to the clicked rating
                for (let i = 1; i <= rating; i++) {
                    document.querySelector(`.star[data-rating="${i}"]`).classList.add('selected');
                }

                this.selectedRating = rating;
            }

            async submitFeedback() {
                if (!this.selectedRating) {
                    alert('Please select a rating before submitting feedback.');
                    return;
                }

                if (!this.currentWorkflowId) {
                    alert('No active workflow to provide feedback for.');
                    return;
                }

                const feedbackText = document.getElementById('feedback-text').value;
                const curationDecisions = document.getElementById('curation-decisions').value;

                try {
                    const response = await fetch(`${this.apiBaseUrl}/workflow/feedback`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            workflow_id: this.currentWorkflowId,
                            rating: parseInt(this.selectedRating),
                            feedback_text: feedbackText || null,
                            curation_decisions: curationDecisions ? JSON.parse(curationDecisions) : null
                        })
                    });

                    const result = await response.json();

                    if (response.ok) {
                        alert('Thank you for your feedback! It will help improve our co-creation process.');
                        this.hideFeedbackModal();
                        this.refreshWorkflowStatus();
                    } else {
                        alert(`Error: ${result.detail}`);
                    }

                } catch (error) {
                    alert(`Network error: ${error.message}`);
                }
            }

            // Utility method to check API health
            async checkHealth() {
                try {
                    const response = await fetch(`${this.apiBaseUrl.replace('/api', '')}/health`);
                    return response.ok;
                } catch (error) {
                    console.error('Health check failed:', error);
                    return false;
                }
            }
        }

        // Initialize the interface when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.genesisInterface = new GenesisInterface();

            // Check API health on load
            window.genesisInterface.checkHealth().then(healthy => {
                if (!healthy) {
                    console.warn('API is not available. Please ensure the backend is running.');
                }
            });
        });
    </script>
</body>
</html>